---
import BaseHead from '@/components/BaseHead.astro';
import { Footer } from '@/components/blocks/footer';
import { Navbar } from '@/components/blocks/navbar';

const { title, description } = Astro.props;

const tenantId = Astro.request.headers.get('x-tenant-id') || Astro.url.searchParams.get('tenantId') || '';
const baseUrl = new URL(Astro.request.url);

let branding = null;
try {
  const res = await fetch(
    new URL(`/api/v1/theme/master/branding?tenantId=${encodeURIComponent(tenantId)}`, baseUrl),
    { headers: tenantId ? { 'X-Tenant-Id': tenantId } : undefined }
  );
  const json = await res.json();
  branding = json?.data || null;
} catch {
  branding = null;
}

const siteName = branding?.site_name || 'Sparti Website Builder';
const siteDescription = branding?.site_description || description;
const logoSrc = branding?.site_logo || null;
const faviconSrc = branding?.site_favicon || null;

---

<html lang="en">
  <head>
    <BaseHead title={title || siteName} description={siteDescription} favicon={faviconSrc} />
  </head>
  <body class={`h-screen antialiased`}>
    <Navbar client:only='react' logoSrc={logoSrc} siteName={siteName} />
    <main><slot /></main>
    <Footer />
  </body>
</html>