# DB Schema vs Migrations Comparison

Generated comparison of current database structure against migration-defined schema.

---

## Summary

| Metric | Count |
|--------|-------|
| Tables in DB | 96 |
| Tables in migrations | 61 |
| Tables only in DB (not in migrations) | 35 |
| Tables with column mismatches | 42 |
| Tables fully matching | 37 |

---

## 1. Tables in DB But NOT in Migrations

These tables exist in the database but have **no corresponding migration**. They may be from:
- Other projects or experiments
- Manual SQL
- Deprecated/legacy features
- Duplicate naming (snake_case vs camelCase variants)

```
account, booking, channel, channel_revenue, dashboard, dashboard_widget,
data_source, datasource, email_settings, form_submissions_extended,
hotel, hotel_revenue, hotel_room, integration_settings, landing_pages,
legal_pages, metric, report, report_data, report_data_source,
report_metric, report_template, report_visualization, reportdata,
reportdatasource, reportmetric, reportvisualization, revenue, room,
site_schemas, smtp_config, test_table, user_account, user_role, useraccount
```

### Observations
- **Hotel/booking/revenue/channel** – Likely a separate hotel/revenue module
- **Report/report_*** – Reporting/analytics module (reportdata vs report_data suggests naming drift)
- **landing_pages, legal_pages** – May have been split from `pages` (page_type) or created manually
- **form_submissions_extended** – Extended form submissions
- **integration_settings, site_schemas, smtp_config, email_settings** – Config/settings tables
- **user_account, useraccount** – Possible duplicate (camelCase vs snake_case)
- **test_table** – Test/sandbox table

---

## 2. Column Discrepancies (Migration vs DB)

### Columns in migrations but NOT in DB (possibly dropped or never applied)

| Table | Missing in DB |
|-------|---------------|
| **tenants** | `template_id` – Dropped by migration `20250127000001-drop-template-id-from-tenants.js` ✓ expected |
| **user_activity_log** | `error_message`, `risk_score`, `session_id`, `success` – In migration raw SQL, may not have been applied |

### Columns in DB but NOT in migrations (extra columns)

| Table | Extra in DB |
|-------|-------------|
| **form_submissions** | `tenant_name` |
| **page_layouts** | `is_default` |
| **user_sessions** | `session_token` |

### Tables with 0 migration cols (entire table not in migrations)

All 35 tables listed in section 1 – full schemas exist only in DB.

---

## 3. Tables Fully Matching (DB = Migrations)

37 tables have matching column sets:

```
analytics_daily_stats, analytics_event_definitions, analytics_events,
analytics_goals, analytics_page_views, analytics_sessions, breadcrumbs,
categories, components, contacts, media, media_folders, media_usage,
order_items, orders, page_components, page_versions, pages, pern_cart,
pern_cart_item, pern_order_item, pern_orders, pern_products, pern_reviews,
post_categories, post_tags, posts, product_categories, product_category_relations,
product_variants, products, project_steps, projects, redirects, robots_config,
security_events, seo_analytics, seo_meta, site_settings, sitemap_entries,
slug_change_log, tags, tenant_api_keys, tenant_databases, tenant_integrations,
term_relationships, term_taxonomy, terms, themes, user_access_keys,
user_login_history, user_password_history, user_permissions, users
```

---

## 4. Recommended Actions

1. **Add migrations for undocumented tables** ✅ DONE  
   Migrations added for used tables:
   - `20250101000000-create-forms-form-fields-email-settings-tables.js` – forms, form_fields, email_settings
   - `20250130000001-create-form-submissions-extended-table.js`
   - `20250130000002-create-site-schemas-table.js`
   - `20250130000003-create-smtp-config-table.js`
   
   Not migrated (not actively used in codebase): `integration_settings`, `landing_pages`, `legal_pages` (legacy/pre-consolidation), hotel/report/account tables, `test_table`.

2. **Resolve extra columns**  
   Decide for `form_submissions.tenant_name`, `page_layouts.is_default`, `user_sessions.session_token`:
   - Add migrations if they are required, or  
   - Drop if obsolete.

3. **Clean up unused tables**  
   Identify and remove or archive unused tables (e.g. `test_table`, hotel/report modules if deprecated).

4. **Resolve naming duplicates**  
   Standardize `reportdata` vs `report_data`, `datasource` vs `data_source`, `useraccount` vs `user_account`.

---

*Generated by `node scripts/migrations/compare-db-with-migrations.js`*
